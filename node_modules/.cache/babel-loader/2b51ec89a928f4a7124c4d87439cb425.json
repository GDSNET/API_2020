{"ast":null,"code":"function createFirefoxPreCSP10Directives(directives, basePolicy) {\n  var result = Object.assign({}, basePolicy);\n  Object.keys(directives).forEach(function (key) {\n    var value = directives[key];\n\n    if (key === 'connectSrc') {\n      result.xhrSrc = value;\n    } else {\n      result[key] = value;\n    }\n\n    if (key === 'scriptSrc') {\n      var optionsValues = [];\n\n      if (value.indexOf(\"'unsafe-inline'\") !== -1) {\n        optionsValues.push('inline-script');\n      }\n\n      if (value.indexOf(\"'unsafe-eval'\") !== -1) {\n        optionsValues.push('eval-script');\n      }\n\n      if (optionsValues.length !== 0) {\n        result.options = optionsValues;\n      }\n    }\n  });\n  return result;\n}\n\nvar handlers = {\n  Firefox: function Firefox(browser, directives) {\n    var version = parseFloat(browser.version);\n\n    if (version >= 4 && version < 23) {\n      var basePolicy = {};\n\n      if (version < 5) {\n        basePolicy.allow = ['*'];\n\n        if (directives.defaultSrc) {\n          basePolicy.allow = directives.defaultSrc;\n          delete directives.defaultSrc;\n        }\n      } else {\n        basePolicy.defaultSrc = ['*'];\n      }\n\n      return createFirefoxPreCSP10Directives(directives, basePolicy);\n    } else {\n      return directives;\n    }\n  },\n  'Firefox Mobile': function FirefoxMobile(browser, directives) {\n    // Handles both Firefox for Android and Firefox OS\n    var family = browser.os.family;\n    var version = parseFloat(browser.version);\n\n    if (family === 'Firefox OS' && version < 32 || family === 'Android' && version < 25) {\n      return createFirefoxPreCSP10Directives(directives, {\n        defaultSrc: ['*']\n      });\n    } else {\n      return directives;\n    }\n  }\n};\n\nmodule.exports = function transformDirectivesForBrowser(browser, directives) {\n  var handler = handlers[browser.name];\n\n  if (handler) {\n    return handler(browser, directives);\n  } else {\n    return directives;\n  }\n};","map":null,"metadata":{},"sourceType":"script"}